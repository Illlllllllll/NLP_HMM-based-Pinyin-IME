# IME 应用 UI 工作流程

## 界面布局

### 默认状态（无输入）

```
┌────────────────────────────────────┐
│         IME Application             │
├────────────────────────────────────┤
│                                     │
│   ┌───────────────────────────┐   │
│   │                            │   │
│   │                            │   │
│   │      serena.jpg            │   │
│   │    （静态图片）            │   │
│   │   380x500 像素             │   │
│   │                            │   │
│   │   点击打开设置              │   │
│   │                            │   │
│   │                            │   │
│   └───────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 已上屏文本：                 │  │
│  │                              │  │
│  └─────────────────────────────┘  │
│                                     │
└────────────────────────────────────┘
```

**特点**：
- 图片占据主要空间
- 输入框完全隐藏
- 候选框完全隐藏
- 输出区域显示历史文本

---

### 输入状态（有输入）

```
┌────────────────────────────────────┐
│         IME Application             │
├────────────────────────────────────┤
│   ┌───────────────────────────┐   │
│   │                            │   │
│   │    serena.jpg (缩小)       │   │
│   │    380x300 像素            │   │
│   │                            │   │
│   └───────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐  │
│  │  ni hao                      │  │ ← 拼音显示
│  └─────────────────────────────┘  │
│                                     │
│  ┌───┬───┬───┬───┬───┐            │
│  │1.你│2.尼│3.泥│4.呢│5.妮│          │ ← 候选按钮
│  └───┴───┴───┴───┴───┘            │
│                                     │
│  ┌─────────────────────────────┐  │
│  │ 已上屏文本：                 │  │
│  │                              │  │
│  └─────────────────────────────┘  │
│                                     │
└────────────────────────────────────┘
```

**特点**：
- 图片缩小到上半部分
- 输入框自动显示
- 候选框自动显示
- 实时更新候选内容

---

## 交互流程

### 流程 1: 基础输入

```
用户操作                 系统响应                      UI 变化
───────────────────────────────────────────────────────────────
1. 按下 'n'     →    添加到缓冲区              显示输入框和候选
                     pinyin_buffer = "n"      
                     显示前缀匹配候选           

2. 按下 'i'     →    追加到缓冲区              更新候选
                     pinyin_buffer = "ni"     
                     显示 "ni" 的候选          候选: 你 尼 泥 呢 妮

3. 按空格       →    确认拼音 "ni"             候选更新
                     decoder.add_pinyin("ni")
                     pinyin_buffer = ""

4. 按下 'h'     →    追加到缓冲区              显示前缀匹配
                     pinyin_buffer = "h"

5. 按下 'a'     →    追加到缓冲区              更新候选
                     pinyin_buffer = "ha"

6. 按下 'o'     →    追加到缓冲区              更新候选
                     pinyin_buffer = "hao"    候选: 你好 你豪...

7. 按 '1' 或    →    选择第一个候选            上屏文本
   回车              commit_text("你好")      输入框隐藏
                     清空状态                  候选框隐藏
                                              输出区显示"你好"
```

---

### 流程 2: 使用退格

```
用户操作                 系统响应                      UI 变化
───────────────────────────────────────────────────────────────
1. 输入 "niha"  →    拼音缓冲区: "niha"        显示输入框和候选

2. 按退格       →    删除最后一个字符          更新候选
                     pinyin_buffer = "nih"

3. 再按退格     →    删除字符                  更新候选
                     pinyin_buffer = "ni"

4. 按空格       →    确认拼音                  更新状态
                     decoder.add_pinyin("ni")

5. 输入 "hao"   →    追加到缓冲区              显示候选
                     pinyin_buffer = "hao"    

6. 按回车       →    上屏                      隐藏输入框
```

---

### 流程 3: 快速选择

```
用户操作                 系统响应                      UI 变化
───────────────────────────────────────────────────────────────
1. 快速输入     →    添加到缓冲区              显示候选
   "nihao"           pinyin_buffer = "nihao"

2. 按数字 '2'   →    选择第二个候选            上屏
                     commit_text(候选[1])     隐藏输入框
                     清空状态
```

---

### 流程 4: 清空输入

```
用户操作                 系统响应                      UI 变化
───────────────────────────────────────────────────────────────
1. 输入 "nihao" →    拼音缓冲区: "nihao"       显示输入框和候选

2. 按 ESC       →    重置解码器                隐藏输入框
                     decoder.reset()          隐藏候选框
                     清空缓冲区                恢复默认状态
```

---

## 设置对话框

点击默认状态下的图片，弹出设置对话框：

```
┌─────────────────────────┐
│     输入法设置          │
├─────────────────────────┤
│                          │
│  Beam Size:  [  100  ]  │
│                          │
│  候选数量:   [   5   ]  │
│                          │
│     [ 确定 ]  [ 取消 ]  │
│                          │
└─────────────────────────┘
```

**参数说明**：

- **Beam Size**：
  - 范围：10-500
  - 默认：100
  - 作用：控制搜索空间大小
  - 效果：更大 = 更准确但更慢

- **候选数量**：
  - 范围：1-9
  - 默认：5
  - 作用：显示的候选个数
  - 效果：更多 = 更多选择

---

## 键盘映射表

| 按键 | 功能 | 触发时机 | 效果 |
|------|------|----------|------|
| **a-z** | 输入拼音 | 任何时候 | 添加到拼音缓冲区，显示输入框 |
| **空格** | 确认拼音 | 有未确认拼音时 | 确认当前拼音分词 |
| **回车** | 上屏 | 有候选时 | 上屏最佳候选，清空输入 |
| **1-9** | 快速选择 | 有候选时 | 选择对应编号的候选 |
| **退格** | 删除 | 有输入时 | 删除最后一个字符/拼音 |
| **ESC** | 清空 | 有输入时 | 清空所有输入和状态 |

---

## 状态机

```
                    ┌─────────────┐
                    │   启动应用   │
                    └──────┬──────┘
                           │
                           ↓
                    ┌─────────────┐
              ┌────→│  默认状态   │←────┐
              │     │  (图片显示)  │     │
              │     └──────┬──────┘     │
              │            │            │
              │      按字母键            │
              │            │            │
              │            ↓            │
              │     ┌─────────────┐    │
              │     │  输入状态   │    │
              │     │  (候选显示)  │    │
              │     └──────┬──────┘    │
              │            │            │
              │     ┌──────┴──────┐    │
              │     │             │    │
              │    ESC        上屏/选择 │
              │     │             │    │
              └─────┘             └────┘
```

---

## UI 组件层次

```
QWidget (IMEApp)
├── QVBoxLayout
    ├── QLabel (image_label) [380x500 或 380x300]
    │   └── QPixmap (serena.jpg)
    │
    ├── QWidget (input_widget) [visible=False]
    │   └── QVBoxLayout
    │       ├── QLabel (pinyin_label) [拼音显示]
    │       └── QHBoxLayout
    │           ├── QPushButton (candidate_buttons[0]) [1.候选]
    │           ├── QPushButton (candidate_buttons[1]) [2.候选]
    │           ├── QPushButton (candidate_buttons[2]) [3.候选]
    │           ├── QPushButton (candidate_buttons[3]) [4.候选]
    │           └── QPushButton (candidate_buttons[4]) [5.候选]
    │
    └── QLabel (output_label) [已上屏文本显示]
```

---

## 样式主题

### 颜色方案

```python
# 主要颜色
BLUE_PRIMARY   = '#3b82f6'  # 输入框边框
GRAY_DARK      = '#111827'  # 图片背景
GRAY_LIGHT     = '#f3f4f6'  # 候选背景
GRAY_LIGHTER   = '#f9fafb'  # 输出背景
GRAY_HOVER     = '#e5e7eb'  # 候选悬停

# 文字颜色
TEXT_DARK      = '#1f2937'
TEXT_LIGHT     = '#6b7280'
```

### 字体

```python
# 拼音输入
Font: Consolas, 16pt

# 候选文字
Font: 默认, 14pt

# 输出文字
Font: 默认, 12pt
```

---

## 响应式行为

### 窗口大小
- **固定大小**：400x600 像素
- **不可调整**：保持一致的用户体验

### 组件尺寸
- **图片（默认）**：380x500
- **图片（输入）**：380x300
- **输入框**：宽度自适应，高度 40px
- **候选按钮**：70x40px 每个
- **输出区域**：最小 60px，自适应内容

---

## 用户体验优化

1. **即时反馈**：
   - 按键立即响应（< 50ms）
   - 候选实时更新

2. **智能隐藏**：
   - 无输入时自动隐藏输入框
   - 节省屏幕空间

3. **快捷操作**：
   - 数字键快速选择
   - 回车一键上屏

4. **容错设计**：
   - 退格随时纠错
   - ESC 快速清空

5. **视觉清晰**：
   - 高对比度配色
   - 清晰的视觉层次
   - 平滑的状态转换

---

## 总结

这个 UI 设计实现了：

✅ **符合用户习惯**：类似系统输入法的体验  
✅ **响应迅速**：实时更新，无延迟感  
✅ **界面简洁**：默认状态只显示图片  
✅ **操作高效**：多种快捷键支持  
✅ **视觉友好**：现代化的设计风格

达到了专业输入法应用的标准！
